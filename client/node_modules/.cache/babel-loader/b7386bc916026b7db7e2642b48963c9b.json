{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport useState from \"rc-util/es/hooks/useState\";\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { STATUS_APPEAR, STATUS_ENTER, STATUS_LEAVE, STATUS_NONE, STEP_ACTIVE, STEP_PREPARE, STEP_PREPARED, STEP_START } from \"../interface\";\nimport useDomMotionEvents from \"./useDomMotionEvents\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\nimport useStepQueue, { DoStep, isActive, SkipStep } from \"./useStepQueue\";\nexport default function useStatus(supportMotion, visible, getElement, _ref) {\n  var _ref$motionEnter = _ref.motionEnter,\n      motionEnter = _ref$motionEnter === void 0 ? true : _ref$motionEnter,\n      _ref$motionAppear = _ref.motionAppear,\n      motionAppear = _ref$motionAppear === void 0 ? true : _ref$motionAppear,\n      _ref$motionLeave = _ref.motionLeave,\n      motionLeave = _ref$motionLeave === void 0 ? true : _ref$motionLeave,\n      motionDeadline = _ref.motionDeadline,\n      motionLeaveImmediately = _ref.motionLeaveImmediately,\n      onAppearPrepare = _ref.onAppearPrepare,\n      onEnterPrepare = _ref.onEnterPrepare,\n      onLeavePrepare = _ref.onLeavePrepare,\n      onAppearStart = _ref.onAppearStart,\n      onEnterStart = _ref.onEnterStart,\n      onLeaveStart = _ref.onLeaveStart,\n      onAppearActive = _ref.onAppearActive,\n      onEnterActive = _ref.onEnterActive,\n      onLeaveActive = _ref.onLeaveActive,\n      onAppearEnd = _ref.onAppearEnd,\n      onEnterEnd = _ref.onEnterEnd,\n      onLeaveEnd = _ref.onLeaveEnd,\n      onVisibleChanged = _ref.onVisibleChanged; // Used for outer render usage to avoid `visible: false & status: none` to render nothing\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      asyncVisible = _useState2[0],\n      setAsyncVisible = _useState2[1];\n\n  var _useState3 = useState(STATUS_NONE),\n      _useState4 = _slicedToArray(_useState3, 2),\n      status = _useState4[0],\n      setStatus = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      style = _useState6[0],\n      setStyle = _useState6[1];\n\n  var mountedRef = useRef(false);\n  var deadlineRef = useRef(null); // =========================== Dom Node ===========================\n\n  function getDomElement() {\n    return getElement();\n  } // ========================== Motion End ==========================\n\n\n  var activeRef = useRef(false);\n  /**\n   * Clean up status & style\n   */\n\n  function updateMotionEndStatus() {\n    setStatus(STATUS_NONE, true);\n    setStyle(null, true);\n  }\n\n  function onInternalMotionEnd(event) {\n    var element = getDomElement();\n\n    if (event && !event.deadline && event.target !== element) {\n      // event exists\n      // not initiated by deadline\n      // transitionEnd not fired by inner elements\n      return;\n    }\n\n    var currentActive = activeRef.current;\n    var canEnd;\n\n    if (status === STATUS_APPEAR && currentActive) {\n      canEnd = onAppearEnd === null || onAppearEnd === void 0 ? void 0 : onAppearEnd(element, event);\n    } else if (status === STATUS_ENTER && currentActive) {\n      canEnd = onEnterEnd === null || onEnterEnd === void 0 ? void 0 : onEnterEnd(element, event);\n    } else if (status === STATUS_LEAVE && currentActive) {\n      canEnd = onLeaveEnd === null || onLeaveEnd === void 0 ? void 0 : onLeaveEnd(element, event);\n    } // Only update status when `canEnd` and not destroyed\n\n\n    if (status !== STATUS_NONE && currentActive && canEnd !== false) {\n      updateMotionEndStatus();\n    }\n  }\n\n  var _useDomMotionEvents = useDomMotionEvents(onInternalMotionEnd),\n      _useDomMotionEvents2 = _slicedToArray(_useDomMotionEvents, 1),\n      patchMotionEvents = _useDomMotionEvents2[0]; // ============================= Step =============================\n\n\n  var getEventHandlers = function getEventHandlers(targetStatus) {\n    var _ref2, _ref3, _ref4;\n\n    switch (targetStatus) {\n      case STATUS_APPEAR:\n        return _ref2 = {}, _defineProperty(_ref2, STEP_PREPARE, onAppearPrepare), _defineProperty(_ref2, STEP_START, onAppearStart), _defineProperty(_ref2, STEP_ACTIVE, onAppearActive), _ref2;\n\n      case STATUS_ENTER:\n        return _ref3 = {}, _defineProperty(_ref3, STEP_PREPARE, onEnterPrepare), _defineProperty(_ref3, STEP_START, onEnterStart), _defineProperty(_ref3, STEP_ACTIVE, onEnterActive), _ref3;\n\n      case STATUS_LEAVE:\n        return _ref4 = {}, _defineProperty(_ref4, STEP_PREPARE, onLeavePrepare), _defineProperty(_ref4, STEP_START, onLeaveStart), _defineProperty(_ref4, STEP_ACTIVE, onLeaveActive), _ref4;\n\n      default:\n        return {};\n    }\n  };\n\n  var eventHandlers = React.useMemo(function () {\n    return getEventHandlers(status);\n  }, [status]);\n\n  var _useStepQueue = useStepQueue(status, !supportMotion, function (newStep) {\n    // Only prepare step can be skip\n    if (newStep === STEP_PREPARE) {\n      var onPrepare = eventHandlers[STEP_PREPARE];\n\n      if (!onPrepare) {\n        return SkipStep;\n      }\n\n      return onPrepare(getDomElement());\n    } // Rest step is sync update\n\n\n    if (step in eventHandlers) {\n      var _eventHandlers$step;\n\n      setStyle(((_eventHandlers$step = eventHandlers[step]) === null || _eventHandlers$step === void 0 ? void 0 : _eventHandlers$step.call(eventHandlers, getDomElement(), null)) || null);\n    }\n\n    if (step === STEP_ACTIVE) {\n      // Patch events when motion needed\n      patchMotionEvents(getDomElement());\n\n      if (motionDeadline > 0) {\n        clearTimeout(deadlineRef.current);\n        deadlineRef.current = setTimeout(function () {\n          onInternalMotionEnd({\n            deadline: true\n          });\n        }, motionDeadline);\n      }\n    }\n\n    if (step === STEP_PREPARED) {\n      updateMotionEndStatus();\n    }\n\n    return DoStep;\n  }),\n      _useStepQueue2 = _slicedToArray(_useStepQueue, 2),\n      startStep = _useStepQueue2[0],\n      step = _useStepQueue2[1];\n\n  var active = isActive(step);\n  activeRef.current = active; // ============================ Status ============================\n  // Update with new status\n\n  useIsomorphicLayoutEffect(function () {\n    setAsyncVisible(visible);\n    var isMounted = mountedRef.current;\n    mountedRef.current = true; // if (!supportMotion) {\n    //   return;\n    // }\n\n    var nextStatus; // Appear\n\n    if (!isMounted && visible && motionAppear) {\n      nextStatus = STATUS_APPEAR;\n    } // Enter\n\n\n    if (isMounted && visible && motionEnter) {\n      nextStatus = STATUS_ENTER;\n    } // Leave\n\n\n    if (isMounted && !visible && motionLeave || !isMounted && motionLeaveImmediately && !visible && motionLeave) {\n      nextStatus = STATUS_LEAVE;\n    }\n\n    var nextEventHandlers = getEventHandlers(nextStatus); // Update to next status\n\n    if (nextStatus && (supportMotion || nextEventHandlers[STEP_PREPARE])) {\n      setStatus(nextStatus);\n      startStep();\n    } else {\n      // Set back in case no motion but prev status has prepare step\n      setStatus(STATUS_NONE);\n    }\n  }, [visible]); // ============================ Effect ============================\n  // Reset when motion changed\n\n  useEffect(function () {\n    if ( // Cancel appear\n    status === STATUS_APPEAR && !motionAppear || // Cancel enter\n    status === STATUS_ENTER && !motionEnter || // Cancel leave\n    status === STATUS_LEAVE && !motionLeave) {\n      setStatus(STATUS_NONE);\n    }\n  }, [motionAppear, motionEnter, motionLeave]);\n  useEffect(function () {\n    return function () {\n      mountedRef.current = false;\n      clearTimeout(deadlineRef.current);\n    };\n  }, []); // Trigger `onVisibleChanged`\n\n  var firstMountChangeRef = React.useRef(false);\n  useEffect(function () {\n    // [visible & motion not end] => [!visible & motion end] still need trigger onVisibleChanged\n    if (asyncVisible) {\n      firstMountChangeRef.current = true;\n    }\n\n    if (asyncVisible !== undefined && status === STATUS_NONE) {\n      // Skip first render is invisible since it's nothing changed\n      if (firstMountChangeRef.current || asyncVisible) {\n        onVisibleChanged === null || onVisibleChanged === void 0 ? void 0 : onVisibleChanged(asyncVisible);\n      }\n\n      firstMountChangeRef.current = true;\n    }\n  }, [asyncVisible, status]); // ============================ Styles ============================\n\n  var mergedStyle = style;\n\n  if (eventHandlers[STEP_PREPARE] && step === STEP_START) {\n    mergedStyle = _objectSpread({\n      transition: 'none'\n    }, mergedStyle);\n  }\n\n  return [status, step, mergedStyle, asyncVisible !== null && asyncVisible !== void 0 ? asyncVisible : visible];\n}","map":{"version":3,"sources":["C:/Users/vyshn/OneDrive/Desktop/Mern project/CarDhundo/client/node_modules/rc-motion/es/hooks/useStatus.js"],"names":["_objectSpread","_defineProperty","_slicedToArray","useState","React","useEffect","useRef","STATUS_APPEAR","STATUS_ENTER","STATUS_LEAVE","STATUS_NONE","STEP_ACTIVE","STEP_PREPARE","STEP_PREPARED","STEP_START","useDomMotionEvents","useIsomorphicLayoutEffect","useStepQueue","DoStep","isActive","SkipStep","useStatus","supportMotion","visible","getElement","_ref","_ref$motionEnter","motionEnter","_ref$motionAppear","motionAppear","_ref$motionLeave","motionLeave","motionDeadline","motionLeaveImmediately","onAppearPrepare","onEnterPrepare","onLeavePrepare","onAppearStart","onEnterStart","onLeaveStart","onAppearActive","onEnterActive","onLeaveActive","onAppearEnd","onEnterEnd","onLeaveEnd","onVisibleChanged","_useState","_useState2","asyncVisible","setAsyncVisible","_useState3","_useState4","status","setStatus","_useState5","_useState6","style","setStyle","mountedRef","deadlineRef","getDomElement","activeRef","updateMotionEndStatus","onInternalMotionEnd","event","element","deadline","target","currentActive","current","canEnd","_useDomMotionEvents","_useDomMotionEvents2","patchMotionEvents","getEventHandlers","targetStatus","_ref2","_ref3","_ref4","eventHandlers","useMemo","_useStepQueue","newStep","onPrepare","step","_eventHandlers$step","call","clearTimeout","setTimeout","_useStepQueue2","startStep","active","isMounted","nextStatus","nextEventHandlers","firstMountChangeRef","undefined","mergedStyle","transition"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport useState from \"rc-util/es/hooks/useState\";\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { STATUS_APPEAR, STATUS_ENTER, STATUS_LEAVE, STATUS_NONE, STEP_ACTIVE, STEP_PREPARE, STEP_PREPARED, STEP_START } from \"../interface\";\nimport useDomMotionEvents from \"./useDomMotionEvents\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\nimport useStepQueue, { DoStep, isActive, SkipStep } from \"./useStepQueue\";\nexport default function useStatus(supportMotion, visible, getElement, _ref) {\n  var _ref$motionEnter = _ref.motionEnter,\n    motionEnter = _ref$motionEnter === void 0 ? true : _ref$motionEnter,\n    _ref$motionAppear = _ref.motionAppear,\n    motionAppear = _ref$motionAppear === void 0 ? true : _ref$motionAppear,\n    _ref$motionLeave = _ref.motionLeave,\n    motionLeave = _ref$motionLeave === void 0 ? true : _ref$motionLeave,\n    motionDeadline = _ref.motionDeadline,\n    motionLeaveImmediately = _ref.motionLeaveImmediately,\n    onAppearPrepare = _ref.onAppearPrepare,\n    onEnterPrepare = _ref.onEnterPrepare,\n    onLeavePrepare = _ref.onLeavePrepare,\n    onAppearStart = _ref.onAppearStart,\n    onEnterStart = _ref.onEnterStart,\n    onLeaveStart = _ref.onLeaveStart,\n    onAppearActive = _ref.onAppearActive,\n    onEnterActive = _ref.onEnterActive,\n    onLeaveActive = _ref.onLeaveActive,\n    onAppearEnd = _ref.onAppearEnd,\n    onEnterEnd = _ref.onEnterEnd,\n    onLeaveEnd = _ref.onLeaveEnd,\n    onVisibleChanged = _ref.onVisibleChanged;\n  // Used for outer render usage to avoid `visible: false & status: none` to render nothing\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    asyncVisible = _useState2[0],\n    setAsyncVisible = _useState2[1];\n  var _useState3 = useState(STATUS_NONE),\n    _useState4 = _slicedToArray(_useState3, 2),\n    status = _useState4[0],\n    setStatus = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    style = _useState6[0],\n    setStyle = _useState6[1];\n  var mountedRef = useRef(false);\n  var deadlineRef = useRef(null);\n\n  // =========================== Dom Node ===========================\n  function getDomElement() {\n    return getElement();\n  }\n\n  // ========================== Motion End ==========================\n  var activeRef = useRef(false);\n\n  /**\n   * Clean up status & style\n   */\n  function updateMotionEndStatus() {\n    setStatus(STATUS_NONE, true);\n    setStyle(null, true);\n  }\n  function onInternalMotionEnd(event) {\n    var element = getDomElement();\n    if (event && !event.deadline && event.target !== element) {\n      // event exists\n      // not initiated by deadline\n      // transitionEnd not fired by inner elements\n      return;\n    }\n    var currentActive = activeRef.current;\n    var canEnd;\n    if (status === STATUS_APPEAR && currentActive) {\n      canEnd = onAppearEnd === null || onAppearEnd === void 0 ? void 0 : onAppearEnd(element, event);\n    } else if (status === STATUS_ENTER && currentActive) {\n      canEnd = onEnterEnd === null || onEnterEnd === void 0 ? void 0 : onEnterEnd(element, event);\n    } else if (status === STATUS_LEAVE && currentActive) {\n      canEnd = onLeaveEnd === null || onLeaveEnd === void 0 ? void 0 : onLeaveEnd(element, event);\n    }\n\n    // Only update status when `canEnd` and not destroyed\n    if (status !== STATUS_NONE && currentActive && canEnd !== false) {\n      updateMotionEndStatus();\n    }\n  }\n  var _useDomMotionEvents = useDomMotionEvents(onInternalMotionEnd),\n    _useDomMotionEvents2 = _slicedToArray(_useDomMotionEvents, 1),\n    patchMotionEvents = _useDomMotionEvents2[0];\n\n  // ============================= Step =============================\n  var getEventHandlers = function getEventHandlers(targetStatus) {\n    var _ref2, _ref3, _ref4;\n    switch (targetStatus) {\n      case STATUS_APPEAR:\n        return _ref2 = {}, _defineProperty(_ref2, STEP_PREPARE, onAppearPrepare), _defineProperty(_ref2, STEP_START, onAppearStart), _defineProperty(_ref2, STEP_ACTIVE, onAppearActive), _ref2;\n      case STATUS_ENTER:\n        return _ref3 = {}, _defineProperty(_ref3, STEP_PREPARE, onEnterPrepare), _defineProperty(_ref3, STEP_START, onEnterStart), _defineProperty(_ref3, STEP_ACTIVE, onEnterActive), _ref3;\n      case STATUS_LEAVE:\n        return _ref4 = {}, _defineProperty(_ref4, STEP_PREPARE, onLeavePrepare), _defineProperty(_ref4, STEP_START, onLeaveStart), _defineProperty(_ref4, STEP_ACTIVE, onLeaveActive), _ref4;\n      default:\n        return {};\n    }\n  };\n  var eventHandlers = React.useMemo(function () {\n    return getEventHandlers(status);\n  }, [status]);\n  var _useStepQueue = useStepQueue(status, !supportMotion, function (newStep) {\n      // Only prepare step can be skip\n      if (newStep === STEP_PREPARE) {\n        var onPrepare = eventHandlers[STEP_PREPARE];\n        if (!onPrepare) {\n          return SkipStep;\n        }\n        return onPrepare(getDomElement());\n      }\n\n      // Rest step is sync update\n      if (step in eventHandlers) {\n        var _eventHandlers$step;\n        setStyle(((_eventHandlers$step = eventHandlers[step]) === null || _eventHandlers$step === void 0 ? void 0 : _eventHandlers$step.call(eventHandlers, getDomElement(), null)) || null);\n      }\n      if (step === STEP_ACTIVE) {\n        // Patch events when motion needed\n        patchMotionEvents(getDomElement());\n        if (motionDeadline > 0) {\n          clearTimeout(deadlineRef.current);\n          deadlineRef.current = setTimeout(function () {\n            onInternalMotionEnd({\n              deadline: true\n            });\n          }, motionDeadline);\n        }\n      }\n      if (step === STEP_PREPARED) {\n        updateMotionEndStatus();\n      }\n      return DoStep;\n    }),\n    _useStepQueue2 = _slicedToArray(_useStepQueue, 2),\n    startStep = _useStepQueue2[0],\n    step = _useStepQueue2[1];\n  var active = isActive(step);\n  activeRef.current = active;\n\n  // ============================ Status ============================\n  // Update with new status\n  useIsomorphicLayoutEffect(function () {\n    setAsyncVisible(visible);\n    var isMounted = mountedRef.current;\n    mountedRef.current = true;\n\n    // if (!supportMotion) {\n    //   return;\n    // }\n\n    var nextStatus;\n\n    // Appear\n    if (!isMounted && visible && motionAppear) {\n      nextStatus = STATUS_APPEAR;\n    }\n\n    // Enter\n    if (isMounted && visible && motionEnter) {\n      nextStatus = STATUS_ENTER;\n    }\n\n    // Leave\n    if (isMounted && !visible && motionLeave || !isMounted && motionLeaveImmediately && !visible && motionLeave) {\n      nextStatus = STATUS_LEAVE;\n    }\n    var nextEventHandlers = getEventHandlers(nextStatus);\n\n    // Update to next status\n    if (nextStatus && (supportMotion || nextEventHandlers[STEP_PREPARE])) {\n      setStatus(nextStatus);\n      startStep();\n    } else {\n      // Set back in case no motion but prev status has prepare step\n      setStatus(STATUS_NONE);\n    }\n  }, [visible]);\n\n  // ============================ Effect ============================\n  // Reset when motion changed\n  useEffect(function () {\n    if (\n    // Cancel appear\n    status === STATUS_APPEAR && !motionAppear ||\n    // Cancel enter\n    status === STATUS_ENTER && !motionEnter ||\n    // Cancel leave\n    status === STATUS_LEAVE && !motionLeave) {\n      setStatus(STATUS_NONE);\n    }\n  }, [motionAppear, motionEnter, motionLeave]);\n  useEffect(function () {\n    return function () {\n      mountedRef.current = false;\n      clearTimeout(deadlineRef.current);\n    };\n  }, []);\n\n  // Trigger `onVisibleChanged`\n  var firstMountChangeRef = React.useRef(false);\n  useEffect(function () {\n    // [visible & motion not end] => [!visible & motion end] still need trigger onVisibleChanged\n    if (asyncVisible) {\n      firstMountChangeRef.current = true;\n    }\n    if (asyncVisible !== undefined && status === STATUS_NONE) {\n      // Skip first render is invisible since it's nothing changed\n      if (firstMountChangeRef.current || asyncVisible) {\n        onVisibleChanged === null || onVisibleChanged === void 0 ? void 0 : onVisibleChanged(asyncVisible);\n      }\n      firstMountChangeRef.current = true;\n    }\n  }, [asyncVisible, status]);\n\n  // ============================ Styles ============================\n  var mergedStyle = style;\n  if (eventHandlers[STEP_PREPARE] && step === STEP_START) {\n    mergedStyle = _objectSpread({\n      transition: 'none'\n    }, mergedStyle);\n  }\n  return [status, step, mergedStyle, asyncVisible !== null && asyncVisible !== void 0 ? asyncVisible : visible];\n}"]},"metadata":{},"sourceType":"module"}